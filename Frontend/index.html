<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>HR System - Login</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
</head>
<body class="bg-light">
<div class="container py-5">
    <h1 class="mb-4">HR System</h1>

    <!-- REGISTER -->
    <div class="card mb-4">
        <div class="card-header">Register</div>
        <div class="card-body">
            <form id="register-form">
                <div class="mb-3">
                    <label for="reg-email" class="form-label">Email</label>
                    <input type="email" id="reg-email" class="form-control" required />
                </div>
                <div class="mb-3">
                    <label for="reg-password" class="form-label">Password</label>
                    <input type="password" id="reg-password" class="form-control" required />
                </div>
                <button type="submit" class="btn btn-primary">Register</button>
            </form>
            <div id="register-message" class="mt-2 text-success"></div>
        </div>
    </div>

    <!-- LOGIN -->
    <div class="card mb-4">
        <div class="card-header">Login</div>
        <div class="card-body">
            <form id="login-form">
                <div class="mb-3">
                    <label for="login-email" class="form-label">Email</label>
                    <input type="email" id="login-email" class="form-control" required />
                </div>
                <div class="mb-3">
                    <label for="login-password" class="form-label">Password</label>
                    <input type="password" id="login-password" class="form-control" required />
                </div>
                <button type="submit" class="btn btn-success">Login</button>
            </form>
            <div id="login-message" class="mt-2"></div>
        </div>
    </div>

    <!-- TOKEN DISPLAY -->
    <div class="card">
        <div class="card-header">Current Token (after login)</div>
        <div class="card-body">
            <textarea id="token-output" class="form-control" rows="4" readonly></textarea>
        </div>
    </div>
</div>

<script>
const API_BASE = "https://hr-system-xd51.onrender.com";

window.addEventListener("DOMContentLoaded", () => {
    const registerForm = document.getElementById("register-form");
    const loginForm = document.getElementById("login-form");
    const tokenOutput = document.getElementById("token-output");

    const storedToken = localStorage.getItem("hr_token");
    if (storedToken && tokenOutput) {
        tokenOutput.value = storedToken;
    }

    if (registerForm) {
        registerForm.addEventListener("submit", async (e) => {
            e.preventDefault();

            const email = document.getElementById("reg-email").value;
            const password = document.getElementById("reg-password").value;
            const messageEl = document.getElementById("register-message");

            messageEl.textContent = "Registering...";

            try {
                const res = await fetch(API_BASE + "/auth/register", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ email, password })
                });

                const data = await res.json();

                if (!res.ok) {
                    messageEl.classList.remove("text-success");
                    messageEl.classList.add("text-danger");
                    messageEl.textContent = data.message || "Registration failed";
                    return;
                }

                messageEl.classList.remove("text-danger");
                messageEl.classList.add("text-success");
                messageEl.textContent = "User registered successfully.";

            } catch (err) {
                console.error(err);
                messageEl.classList.remove("text-success");
                messageEl.classList.add("text-danger");
                messageEl.textContent = "Network error";
            }
        });
    }

    if (loginForm) {
        loginForm.addEventListener("submit", async (e) => {
            e.preventDefault();

            const email = document.getElementById("login-email").value;
            const password = document.getElementById("login-password").value;
            const messageEl = document.getElementById("login-message");

            messageEl.textContent = "Logging in...";

            try {
                const res = await fetch(API_BASE + "/auth/login", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ email, password })
                });

                const data = await res.json();

                if (!res.ok) {
                    messageEl.classList.remove("text-success");
                    messageEl.classList.add("text-danger");
                    messageEl.textContent = data.message || "Login failed";
                    return;
                }

                localStorage.setItem("hr_token", data.token);
                if (tokenOutput) tokenOutput.value = data.token;

                messageEl.classList.remove("text-danger");
                messageEl.classList.add("text-success");
                messageEl.textContent = "Login successful â€” redirecting...";

                setTimeout(() => {
                    window.location.href = "employees.html";
                }, 800);

            } catch (err) {
                console.error(err);
                messageEl.classList.remove("text-success");
                messageEl.classList.add("text-danger");
                messageEl.textContent = "Network error";
            }
        });
    }
});
</script>
</body>
</html>


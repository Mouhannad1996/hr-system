<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Employees - HR System</title>
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
    rel="stylesheet"
  >
</head>
<body class="bg-light">
  <div class="container py-4">
    <h1 class="mb-4">Employees</h1>

    <!-- EMPLOYEE FORM -->
    <div class="card mb-4">
      <div class="card-header">Add / Edit employee</div>
      <div class="card-body">
        <form id="employeeForm">
          <div class="row mb-3">
            <div class="col-md-6">
              <label class="form-label" for="firstName">First name</label>
              <input type="text" class="form-control" id="firstName" required>
            </div>
            <div class="col-md-6">
              <label class="form-label" for="lastName">Last name</label>
              <input type="text" class="form-control" id="lastName" required>
            </div>
          </div>

          <div class="mb-3">
            <label class="form-label" for="email">Email</label>
            <input type="email" class="form-control" id="email" required>
          </div>

          <div class="row mb-3">
            <div class="col-md-6">
              <label class="form-label" for="position">Position</label>
              <input type="text" class="form-control" id="position" required>
            </div>
            <div class="col-md-6">
              <label class="form-label" for="department">Department</label>
              <input type="text" class="form-control" id="department" value="HR" required>
            </div>
          </div>

          <div class="row mb-3">
            <div class="col-md-6">
              <label class="form-label" for="hireDate">Hire date</label>
              <input type="date" class="form-control" id="hireDate" required>
            </div>
            <div class="col-md-6">
              <label class="form-label" for="status">Status</label>
              <select class="form-select" id="status">
                <option value="active" selected>Active</option>
                <option value="inactive">Inactive</option>
              </select>
            </div>
          </div>

          <button type="submit" class="btn btn-primary">Save employee</button>
        </form>

        <div id="employeeFormStatus" class="mt-3 text-muted"></div>
      </div>
    </div>

    <!-- EMPLOYEES LIST -->
    <div class="card">
      <div class="card-header d-flex justify-content-between align-items-center">
        <span>Employees list</span>
        <button id="refreshEmployeesBtn" class="btn btn-sm btn-secondary">
          Refresh employees
        </button>
      </div>
      <div class="card-body">
        <div id="employeesStatus" class="mb-2 text-muted">Loading employeesâ€¦</div>
        <div class="table-responsive">
          <table class="table table-striped" id="employeesTable">
            <thead>
              <tr>
                <th>ID</th>
                <th>First name</th>
                <th>Last name</th>
                <th>Email</th>
                <th>Position</th>
                <th>Department</th>
                <th>Hire date</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              <!-- rows injected by JS -->
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- SCRIPT -->
  <script>
    const API_BASE = 'http://localhost:4000';

    function getToken() {
      return localStorage.getItem('hr_jwt');
    }

    // Handle form submit (create employee)
    document.getElementById('employeeForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const statusDiv = document.getElementById('employeeFormStatus');
      statusDiv.textContent = '';

      console.log('Save employee clicked'); // debug

      const token = getToken();
      if (!token) {
        statusDiv.textContent = 'You are not logged in (no token found). Please log in first.';
        return;
      }

      const body = {
        first_name: document.getElementById('firstName').value,
        last_name: document.getElementById('lastName').value,
        email: document.getElementById('email').value,
        position: document.getElementById('position').value,
        department: document.getElementById('department').value,
        hire_date: document.getElementById('hireDate').value,
        status: document.getElementById('status').value
      };

      try {
        const res = await fetch(\`\${API_BASE}/employees\`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': \`Bearer \${token}\`
          },
          body: JSON.stringify(body)
        });

        const data = await res.json();

        if (!res.ok) {
          statusDiv.textContent = \`Error from server: \${JSON.stringify(data)}\`;
          return;
        }

        statusDiv.textContent = \`Employee created with ID \${data.employee.id}\`;
        e.target.reset();
        await loadEmployees();
      } catch (err) {
        statusDiv.textContent = \`Network error: \${err.message}\`;
      }
    });

    // Load employees into the table
    async function loadEmployees() {
      const statusDiv = document.getElementById('employeesStatus');
      statusDiv.textContent = '';

      const token = getToken();
      if (!token) {
        statusDiv.textContent = 'You are not logged in (no token found). Please log in first.';
        return;
      }

      try {
        const res = await fetch(\`\${API_BASE}/employees\`, {
          headers: {
            'Authorization': \`Bearer \${token}\`
          }
        });

        const data = await res.json();

        if (!res.ok) {
          statusDiv.textContent = \`Error loading employees: \${res.status} \${JSON.stringify(data)}\`;
          return;
        }

        const tbody = document.querySelector('#employeesTable tbody');
        tbody.innerHTML = '';

        data.forEach(emp => {
          const tr = document.createElement('tr');
          tr.innerHTML = \`
            <td>\${emp.id}</td>
            <td>\${emp.first_name}</td>
            <td>\${emp.last_name}</td>
            <td>\${emp.email}</td>
            <td>\${emp.position}</td>
            <td>\${emp.department}</td>
            <td>\${new Date(emp.hire_date).toLocaleDateString()}</td>
            <td>\${emp.status}</td>
          \`;
          tbody.appendChild(tr);
        });

        statusDiv.textContent = 'Employees loaded.';
      } catch (err) {
        statusDiv.textContent = \`Error loading employees: \${err.message}\`;
      }
    }

    // Refresh button
    document
      .getElementById('refreshEmployeesBtn')
      .addEventListener('click', loadEmployees);

    // Load on page open
    window.addEventListener('DOMContentLoaded', loadEmployees);
  </script>
</body>
</html>

